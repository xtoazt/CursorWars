<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Multiplayer Cursor Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script src="https://cdn.socket.io/4.5.1/socket.io.min.js"></script>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const socket = io('https://your-vercel-deployment.vercel.app/api/socket'); // Replace with your deployment URL

    const players = {};
    let selfId;

    // Track mouse position
    let mouseX = 0, mouseY = 0;
    canvas.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;

      socket.emit('move', { x: mouseX, y: mouseY });
    });

    // Handle clicks
    canvas.addEventListener('click', (e) => {
      if (e.shiftKey) {
        // Heal
        socket.emit('click', { type: 'heal' });
      } else {
        // Attack
        const targetId = getTargetUnderCursor();
        if (targetId) {
          socket.emit('click', { type: 'attack', targetId });
        }
      }
    });

    // Get the target player under the cursor
    function getTargetUnderCursor() {
      for (const id in players) {
        const player = players[id];
        const dist = Math.hypot(player.x - mouseX, player.y - mouseY);
        if (dist < 20) return id;
      }
      return null;
    }

    // Socket.io events
    socket.on('init', (serverPlayers) => {
      Object.assign(players, serverPlayers);
    });

    socket.on('new-player', ({ id, data }) => {
      players[id] = data;
    });

    socket.on('player-move', ({ id, x, y }) => {
      if (players[id]) {
        players[id].x = x;
        players[id].y = y;
      }
    });

    socket.on('update-health', ({ id, health }) => {
      if (players[id]) {
        players[id].health = health;
      }
    });

    socket.on('player-death', ({ id }) => {
      if (players[id]) {
        delete players[id];
      }
    });

    socket.on('player-disconnect', ({ id }) => {
      if (players[id]) {
        delete players[id];
      }
    });

    // Draw loop
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw players
      for (const id in players) {
        const player = players[id];
        const isSelf = id === selfId;

        // Draw cursor
        ctx.beginPath();
        ctx.arc(player.x, player.y, 10, 0, Math.PI * 2);
        ctx.fillStyle = isSelf ? 'blue' : 'red';
        ctx.fill();

        // Draw health bar
        ctx.fillStyle = 'green';
        ctx.fillRect(player.x - 20, player.y + 15, (player.health / 100) * 40, 5);

        // Draw rank
        ctx.fillStyle = 'black';
        ctx.font = '12px Arial';
        ctx.fillText(`Rank: ${player.rank}`, player.x - 20, player.y - 10);
      }

      requestAnimationFrame(draw);
    }

    draw();
  </script>
</body>
</html>
